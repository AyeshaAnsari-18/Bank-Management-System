<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Login and Signup Form</title>
   <link rel="stylesheet" href="formstyle.css">
</head>
<body>
   <div class="wrapper">
      <div class="title">
         <span id="formTitle">Login Form</span>
      </div>

      <!-- Success Message -->
      <div id="successMessage" class="success-message" style="display: none; color: green; text-align: center;">
         <h1>Registration Successful!</h1>
         <p>Your registration was successful! Your Customer ID has been sent to your email. Please use it to log in.</p>
      </div>

      <!-- Error Message -->
      <div id="errorMessage" class="error-message" style="display: none; color: red; text-align: center;"></div>

      <!-- Login Form -->
      <form id="loginForm" style="display: block;">
         <div class="field">
            <input type="text" id="customer_id" name="customer_id" required placeholder=" ">
            <label for="customer_id">Customer ID</label>
         </div>
         <div class="field">
            <input type="password" id="password" name="password" required minlength="8" placeholder=" ">
            <label for="password">Password</label>
         </div>
         <div class="content">
            <div class="checkbox">
               <input type="checkbox" id="remember-me">
               <label for="remember-me">Remember me</label>
            </div>
         </div>
         <div class="field">
            <input type="submit" value="Login">
         </div>
         <div class="signup-link">
            Not a user? <a href="#" onclick="toggleForm('signup')">Signup now</a>
         </div>
      </form>

      <!-- Signup Form -->
      <form id="signupForm" action="signup.php" method="POST" style="display: none;" onsubmit="return validateSignup()">
         <div class="field">
            <input type="text" name="name" required placeholder=" ">
            <label for="name">Full Name</label>
         </div>
         <div class="field">
            <input type="email" name="email" required placeholder=" ">
            <label for="email">Email Address</label>
         </div>
         <div class="field">
            <input type="text" name="address" required placeholder=" ">
            <label for="address">Address</label>
         </div>
         <div class="field">
            <input type="date" name="dob" required placeholder=" ">
            <label for="dob">Date of Birth</label>
         </div>
         <div class="field">
            <input type="tel" name="phone" required placeholder=" ">
            <label for="phone">Phone Number</label>
         </div>
         <div class="field">
            <input type="text" name="account_id" required placeholder=" ">
            <label for="account_id">Account ID</label>
         </div>
         <div class="field">
            <input type="password" name="signup_password" required minlength="8" placeholder=" ">
            <label for="signup_password">Password</label>
         </div>
         <div class="field">
            <input type="password" name="confirm_password" required minlength="8" placeholder=" ">
            <label for="confirm_password">Confirm Password</label>
         </div>
         <div class="field">
            <input type="submit" value="Signup">
         </div>
         <div class="signup-link">
            Already a user? <a href="#" onclick="toggleForm('login')">Login now</a>
         </div>
      </form>
   </div>

   <script>
      window.onload = function() {
         const urlParams = new URLSearchParams(window.location.search);
         const successMessage = document.getElementById("successMessage");
         const errorMessage = document.getElementById("errorMessage");

         // Display success message if signup was successful
         if (urlParams.get("success") === "1") {
            successMessage.style.display = "block";
            toggleForm('login');
         }

         // Display error messages dynamically
         const error = urlParams.get("error");
         if (error) {
            errorMessage.style.display = "block";
            const errorMessages = {
               incorrect_password: "Incorrect password. Please try again.",
               invalid_customer_id: "Invalid Customer ID. Please try again.",
               missing_fields: "Please fill in all required fields.",
               email_exists: "Email already exists. Please use a different email address.",
               password_mismatch: "Passwords do not match.",
               registration_failed: "Registration failed. Please try again.",
               email_not_sent: "Account created, but we couldn't send the email. Please try again later.",
               database_error: "A database error occurred. Please try again later."
            };
            errorMessage.textContent = errorMessages[error] || "An unknown error occurred.";
            if (["email_exists", "password_mismatch", "registration_failed"].includes(error)) {
               toggleForm('signup');
            }
         }
      };

      function toggleForm(form) {
         const loginForm = document.getElementById("loginForm");
         const signupForm = document.getElementById("signupForm");
         const formTitle = document.getElementById("formTitle");

         if (form === "signup") {
            loginForm.style.display = "none";
            signupForm.style.display = "block";
            formTitle.textContent = "Signup Form";
         } else {
            loginForm.style.display = "block";
            signupForm.style.display = "none";
            formTitle.textContent = "Login Form";
         }
      }

      document.getElementById("loginForm").addEventListener("submit", async function (e) {
         e.preventDefault();
         const customerId = document.getElementById("customer_id").value.trim();
         const password = document.getElementById("password").value.trim();

         if (!customerId || !password) {
            alert("Please fill in all fields.");
            return;
         }

         try {
            const response = await fetch('api/login_api.php', {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ customer_id: customerId, password: password })
            });

            const result = await response.json();

            if (result.status === 'success') {
               window.location.href = "Bankhome.php";
            } else {
               alert(result.message || "Login failed. Please try again.");
            }
         } catch (error) {
            console.error("Error:", error);
            alert("An error occurred. Please try again.");
         }
      });

      function validateSignup() {
         const name = document.querySelector("[name='name']").value.trim();
         const email = document.querySelector("[name='email']").value.trim();
         const address = document.querySelector("[name='address']").value.trim();
         const dob = document.querySelector("[name='dob']").value;
         const phone = document.querySelector("[name='phone']").value.trim();
         const accountId = document.querySelector("[name='account_id']").value.trim();
         const password = document.querySelector("[name='signup_password']").value;
         const confirmPassword = document.querySelector("[name='confirm_password']").value;

         if (!name || !email || !address || !dob || !phone || !accountId || !password || !confirmPassword) {
            alert("Please fill in all required fields.");
            return false;
         }

         if (password !== confirmPassword) {
            alert("Passwords do not match.");
            return false;
         }

         return true;
      }
   </script>
</body>
</html>
